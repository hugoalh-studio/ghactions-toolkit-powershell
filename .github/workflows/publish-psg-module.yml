# $<Schema>$ https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions
name: "Publish - PowerShell Gallery - Module"
on:
  release:
    types:
      - "published"
  workflow_dispatch:
jobs:
  publish-psg-module:
    name: "Publish - PowerShell Gallery - Module"
    runs-on: "windows-latest"
    steps:
      - name: "Checkout Repository"
        uses: "actions/checkout@v2.4.0"
      - name: "Install PowerShellGet"
        run: |
          Install-Module -Name PowerShellGet -Verbose
        shell: "pwsh"
      - name: "Update PowerShell Modules"
        run: |
          Update-Module -Verbose
        shell: "pwsh"
      - name: "Test Publish"
        run: |
          Publish-Module -Path .\hugoalh.GitHubActionsToolkit\ -NugetAPIKey 'GUID' -WhatIf -Verbose
        shell: "pwsh"
      - name: "Publish"
        run: |
          Publish-Module -Path .\hugoalh.GitHubActionsToolkit\ -NugetAPIKey '${{secrets.POWERSHELLGALLERY_TOKEN}}' -Verbose
        shell: "pwsh"
